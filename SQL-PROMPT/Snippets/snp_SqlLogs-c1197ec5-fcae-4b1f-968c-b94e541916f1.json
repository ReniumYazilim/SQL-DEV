{
  "id": "c1197ec5-fcae-4b1f-968c-b94e541916f1",
  "prefix": "snp_SqlLogs",
  "description": "",
  "body": "-- Debug verilerini direkt log tablosuna kaydet\r\n            Insert Into dbo.Tb_Rn_System_SqlLogs (LogSource, LogType, LogMessage, LogDetail, LogDate, UserName)\r\n            Select  'Sp_Rn_Inventory_FillPurchaseOrderDetailsComplete', 'DEBUG'\r\n                  , 'INSERT Data - ItemId: ' + CAST(ISPO.ItemId As Varchar(10)) + ' - BillId: '\r\n                    + CAST(@BillId As Varchar(10))\r\n                  , 'BillId: ' + CAST(@BillId As Varchar(10)) + ', ItemId: ' + CAST(ISPO.ItemId As Varchar(10))\r\n                    + ', LotCode: ' + ISNULL(ISPO.LotCode, 'NULL') + ', Quantity: '\r\n                    + CAST(ISPO.Quantity As Varchar(20)) + ', LotId: ' + CAST(ISNULL(ISPO.LotId, 0) As Varchar(10))\r\n                    + ', OrderItemId: ' + CAST(ISNULL(ISPO.OrderItemId, 0) As Varchar(10)) + ', UnitPrice: '\r\n                    + CAST(ISNULL(POI.UnitPrice, 0) As Varchar(20)) + ', CurrencyUnitID: '\r\n                    + CAST(ISNULL(POI.CurrencyUnitID, 0) As Varchar(10)) + ', AddUser: ' + CAST(@sssip As Varchar(10))\r\n                  , GETDATE(), System_User\r\n            From    dbo.Tmp_Rn_Inventory_SelectPurchasingOrder ISPO\r\n                    Inner Join @SelectedOrders SO On\r\n                               SO.TmpId = ISPO.TmpId\r\n                    Left Outer Join dbo.Tb_Rn_Purchasing_OrderItems POI On\r\n                                    POI.OrderItemId = ISPO.OrderItemId\r\n            Where   ISPO.Quantity > 0\r\n\r\n            -- Özet log kaydı\r\n            Declare @RecordCount Int\r\n\r\n            Select  @RecordCount = COUNT(*)\r\n            From    dbo.Tmp_Rn_Inventory_SelectPurchasingOrder ISPO\r\n                    Inner Join @SelectedOrders SO On\r\n                               SO.TmpId = ISPO.TmpId\r\n            Where   ISPO.Quantity > 0\r\n\r\n            Insert Into dbo.Tb_Rn_System_SqlLogs (LogSource, LogType, LogMessage, LogDetail, LogDate, UserName)\r\n            Values ('Sp_Rn_Inventory_FillPurchaseOrderDetailsComplete', 'DEBUG'\r\n                  , 'TransactionTypeId=1 - INSERT işlemi başlatılıyor'\r\n                  , 'BillId: ' + CAST(@BillId As Varchar(10)) + ', Toplam kayıt: ' + CAST(@RecordCount As Varchar(10))\r\n                    + ', UserId: ' + CAST(@sssip As Varchar(10)), GETDATE(), System_User)\r\n\r\n            -- Asıl INSERT işlemi\r\n            Insert  dbo.Tb_Rn_Inventory_BillItems (BillId, ItemId, LotCode, Quantity, LotId, AddDate, AddUser, SourceId\r\n                                                   , Price, CurrencyUnitId)\r\n            Select  @BillId, ISPO.ItemId, ISPO.LotCode, ISPO.Quantity, ISPO.LotId, GETDATE(), @sssip, ISPO.OrderItemId\r\n                  , POI.UnitPrice, POI.CurrencyUnitID\r\n            From    dbo.Tmp_Rn_Inventory_SelectPurchasingOrder ISPO\r\n                    Inner Join @SelectedOrders SO On\r\n                               SO.TmpId = ISPO.TmpId\r\n                    Left Outer Join dbo.Tb_Rn_Purchasing_OrderItems POI On\r\n                                    POI.OrderItemId = ISPO.OrderItemId\r\n            Where   ISPO.Quantity > 0\r\n\r\n            -- INSERT sonrası log\r\n            Insert Into dbo.Tb_Rn_System_SqlLogs (LogSource, LogType, LogMessage, LogDetail, LogDate, UserName)\r\n            Values ('Sp_Rn_Inventory_FillPurchaseOrderDetailsComplete', 'INFO'\r\n                  , 'INSERT Tamamlandı - BillId: ' + CAST(@BillId As Varchar(10))\r\n                  , 'Etkilenen kayıt sayısı: ' + CAST(@@ROWCOUNT As Varchar(10)), GETDATE(), System_User)"
}