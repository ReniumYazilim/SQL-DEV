{
  "id": "5ea67034-3cf1-49af-b7fe-2dbb9e1c6cbb",
  "prefix": "snp_MrpDebug",
  "description": "",
  "body": "Declare @UrunID Int = 1666, @sssip Int = 208, @RunLogID Int = 1\r\n\r\n--Select  * From  dbo.MRP_Work_UrunParametreleri MWUP Where   MWUP.UrunID = @UrunID\r\n\r\n--Select  * From  dbo.MRP_Work_Talep MWT Where MWT.UrunID = @UrunID\r\n\r\n--Select  * From  dbo.MRP_Work_Hesaplama MWH Where MWH.UrunID = @UrunID\r\n\r\n--------------------\r\nSelect  @RunLogID, TRSOI.ItemId\r\n      , ISNULL(TRSOI.DueDate, GETDATE() + 1)    --, Case When ISNULL(wo.ToplamAcilIsEmri, 0) >= TRSOI.Quantity Then 0\r\n                                                --       Else TRSOI.Quantity - ISNULL(wo.ToplamAcilIsEmri, 0) End As EksikMiktar\r\n      , TRSOI.Quantity, CONCAT('SO-', TRSO.OrderId, '-', TRSOI.OrderItemId)\r\nFrom    dbo.Tb_Rn_Sales_Orders TRSO\r\n        Inner Join dbo.Tb_Rn_Sales_OrderItems TRSOI On\r\n                   TRSOI.OrderId = TRSO.OrderId\r\n        Inner Join dbo.Tmp_Rn_Sales_OrderItems SOI On\r\n                   SOI.OrderItemId = TRSOI.OrderItemId And SOI.AddUser = @sssip\r\n        Left Join (\r\n                  -- Aynı ürün için açık iş emirlerini topla\r\n                  Select    TRPB.ItemId, SUM(TRPWO.Quantity) ToplamAcilIsEmri\r\n                  From      dbo.Tb_Rn_Planning_WorkOrders TRPWO\r\n                            Inner Join dbo.Tb_Rn_Production_OrderItems TRPOI On\r\n                                       TRPOI.ProductionOrderItemId = TRPWO.ProductionOrderItemId\r\n                            Inner Join dbo.Tmp_Rn_Sales_OrderItems SOI2 On\r\n                                       TRPOI.OrderItemId = SOI2.OrderItemId And TRPOI.AddUser = @sssip\r\n                            Inner Join dbo.Tb_Rn_Production_Boms TRPB On\r\n                                       TRPB.BomId = TRPWO.BomId\r\n                            Inner Join dbo.Tb_Rn_Planning_WorkOrderOperations TRPWOO On\r\n                                       TRPWOO.WorkOrderId = TRPWO.WorkOrderId\r\n                            Inner Join dbo.Tb_Rn_Planning_WorkOrderOperationWorkStations TRPWOOWS On\r\n                                       TRPWOOWS.WorkOrderOperationId = TRPWOO.WorkOrderOperationId\r\n                  Where     TRPWOOWS.WorkOrderOperationWorkStationStatusId In (0, 1)\r\n                  Group By  TRPB.ItemId) wo On\r\n                                            wo.ItemId = TRSOI.ItemId\r\n--Where   TRSOI.OrderStatusId In (3, 1);"
}