{
  "id": "8373f257-083d-467b-823a-ced26bf2d671",
  "prefix": "bakımlistele",
  "description": "Bakım listele",
  "body": "-- 1. Son 24 saatte yapılan tüm bakımları listele\r\nSELECT \r\n    SchemaName,\r\n    TableName,\r\n    IndexName,\r\n    FragmentationLevel AS [Fragmentation %],\r\n    Action,\r\n    ExecutionDate,\r\n    Duration AS [Duration (Seconds)],\r\n    CASE \r\n        WHEN Duration > 3600 THEN CONCAT(CAST(Duration / 3600.0 AS decimal(10, 2)), ' hours')\r\n        WHEN Duration > 60 THEN CONCAT(CAST(Duration / 60.0 AS decimal(10, 2)), ' minutes')\r\n        ELSE CONCAT(Duration, ' seconds')\r\n    END AS [Duration Readable]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nWHERE ExecutionDate >= DATEADD(HOUR, -24, GETDATE())\r\nORDER BY ExecutionDate DESC;\r\n\r\n\r\n-- 2. En uzun süren ilk 10 index bakımı\r\nSELECT TOP 10\r\n    SchemaName + '.' + TableName AS [Table],\r\n    IndexName,\r\n    FragmentationLevel AS [Fragmentation %],\r\n    Action,\r\n    ExecutionDate,\r\n    Duration AS [Duration (Seconds)],\r\n    CASE \r\n        WHEN Duration > 3600 THEN CONCAT(CAST(Duration / 3600.0 AS decimal(10, 2)), ' hours')\r\n        WHEN Duration > 60 THEN CONCAT(CAST(Duration / 60.0 AS decimal(10, 2)), ' minutes')\r\n        ELSE CONCAT(Duration, ' seconds')\r\n    END AS [Duration Readable]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nORDER BY Duration DESC;\r\n\r\n\r\n-- 3. Tablolara göre özet rapor\r\nSELECT \r\n    SchemaName + '.' + TableName as [Table],\r\n    COUNT(*) as [Total Maintenance Count],\r\n    MAX(ExecutionDate) as [Last Maintenance Date],\r\n    AVG(FragmentationLevel) as [Avg Fragmentation %],\r\n    SUM(CASE WHEN Action = 'REBUILD' THEN 1 ELSE 0 END) as [Rebuild Count],\r\n    SUM(CASE WHEN Action = 'REORGANIZE' THEN 1 ELSE 0 END) as [Reorganize Count],\r\n    SUM(Duration) as [Total Duration (Seconds)]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nGROUP BY SchemaName + '.' + TableName\r\nORDER BY [Total Duration (Seconds)] DESC\r\n\r\n-- 4. Belirli bir tarih aralığındaki bakımları listele\r\nDECLARE @StartDate DATE = '2024-01-01'\r\nDECLARE @EndDate DATE = '2024-12-31'\r\n\r\nSELECT \r\n    SchemaName + '.' + TableName as [Table],\r\n    IndexName,\r\n    FragmentationLevel as [Fragmentation %],\r\n    Action,\r\n    ExecutionDate,\r\n    Duration as [Duration (Seconds)]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nWHERE ExecutionDate BETWEEN @StartDate AND @EndDate\r\nORDER BY ExecutionDate DESC\r\n\r\n-- 5. Belirli bir tablonun bakım geçmişi\r\nDECLARE @TableName NVARCHAR(255) = 'YourTableName'  -- Tablo adını buraya yazın\r\n\r\nSELECT \r\n    IndexName,\r\n    FragmentationLevel as [Fragmentation %],\r\n    Action,\r\n    ExecutionDate,\r\n    Duration as [Duration (Seconds)],\r\n    CASE \r\n        WHEN Duration > 3600 THEN CAST(Duration/3600.0 as decimal(10,2)) + ' hours'\r\n        WHEN Duration > 60 THEN CAST(Duration/60.0 as decimal(10,2)) + ' minutes'\r\n        ELSE CAST(Duration as varchar) + ' seconds'\r\n    END as [Duration Readable]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nWHERE TableName = @TableName\r\nORDER BY ExecutionDate DESC\r\n\r\n-- 6. Günlük bakım özeti\r\nSELECT \r\n    CAST(ExecutionDate as DATE) as [Maintenance Date],\r\n    COUNT(*) as [Total Operations],\r\n    SUM(CASE WHEN Action = 'REBUILD' THEN 1 ELSE 0 END) as [Rebuild Count],\r\n    SUM(CASE WHEN Action = 'REORGANIZE' THEN 1 ELSE 0 END) as [Reorganize Count],\r\n    AVG(FragmentationLevel) as [Avg Fragmentation %],\r\n    SUM(Duration) as [Total Duration (Seconds)],\r\n    MAX(Duration) as [Max Duration (Seconds)]\r\nFROM TEKAYDINLAR.dbo.IndexMaintenanceLog\r\nGROUP BY CAST(ExecutionDate as DATE)\r\nORDER BY [Maintenance Date] DESC"
}